---
import { AstroCookieSetOptions } from "astro";
import Layout from "../components/Layout.astro";
import { server } from "@wolf-project/backend/src/server";
const urlToken = Astro.url.searchParams.get("token");

if (urlToken === null) return Astro.redirect("401");

const result = await server({ user: null }).authenticate.session({ token: urlToken });

if (typeof result === "string") {
  Astro.cookies.set("x-auth-token", result, { path: "/" } as AstroCookieSetOptions);
  return Astro.redirect("/");
} else return Astro.redirect("401");
---

<Layout title={undefined} description={undefined} />
