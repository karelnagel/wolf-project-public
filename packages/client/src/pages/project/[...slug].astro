---
import { useTranslations } from "@wolf-project/i18n";
import Layout from "../../components/Layout.astro";
import { db, like, Projects, Tasks } from "astro:db";
import { AddTask } from "../../components/Task";

const t = useTranslations("en");

const { slug } = Astro.params;
const id = slug?.split("/")[0];
if (!id) throw new Error("id is required");
console.log("ID:", id);
const project = await db.select().from(Projects).where(like(Projects.projectId, id));
const tasks = await db.select().from(Tasks).where(like(Tasks.projectRef, id));
---

<Layout title={undefined} description={undefined}>
  <p>{t.project.title}</p>
  {
    project.map(({ projectId, projectName }) => (
      <div>
        <p>Project ID: {projectId}</p>
        <p>Project Name: {projectName}</p>
      </div>
    ))
  }
  {
    tasks.map(({ taskId, title, description, deadline, status }) => (
      <div>
        <p>Task ID: {taskId}</p>
        <p>Task title: {title}</p>
        <p>Task descriptio: {description}</p>
        <p>Deadline: {deadline}</p>
        <p>Status: {status}</p>
      </div>
    ))
  }
  <AddTask projectRef={id} client:load />
</Layout>
