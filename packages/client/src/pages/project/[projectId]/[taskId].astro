---
import Layout from "../../../components/Layout.astro";
import { db } from "@wolf-project/db";
// Todo where is this?
// import { AddComment } from "../../../components/Comment";


const { taskId } = Astro.params;
if (!taskId) throw new Error("id is required");

const task = await db.query.tasksTable.findFirst({
  where: (x, { eq }) => eq(x.id, taskId),
  with: { comments: { with: { commenter: true } } },
});
if (!task) throw new Error("task not found");
---

<Layout title={undefined} description={undefined}>
  <a class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline" href="/"></a>
  <p>Task subpage</p>
  <div>
    <p>Task ID: {task.id}</p>
    <p>Task title: {task.title}</p>
    <p>Task description: {task.description}</p>
    <p>
      Deadline:{" "}
      {
        task.deadline !== null
          ? `${task.deadline!.getDate()}.${task.deadline!.getMonth() + 1}.${task.deadline!.getFullYear()}`
          : null
      }
    </p>
    <p>Status: {task.status}</p>
  </div>
  <div>
    {
      task.comments.map(({ body, commenter: { name }, createdAt }) => (
        <div>
          <p>
            {name}
            {`${createdAt!.getHours()}:${createdAt.getMinutes()} ${createdAt!.getDate()}.${createdAt!.getMonth() + 1}.${createdAt!.getFullYear()}`}
          </p>
          <p>{body} </p>
        </div>
      ))
    }
  </div>

  <!-- <AddComment taskId={id} commenterId={userId} client:load /> -->
</Layout>
