---
import Layout from "../../components/Layout.astro";
import { db, like, Projects, Tasks } from "astro:db";
// Todo idk kust see import peaks tulema
// import { AddTask } from "../../components/Task";

const t = Astro.locals.t;
const { projectId } = Astro.params;
if (!projectId) throw new Error("id is required");
const project = await db.select().from(Projects).where(like(Projects.projectId, projectId));
const tasks = await db.select().from(Tasks).where(like(Tasks.projectRef, projectId));
---

<Layout title={undefined} description={undefined}>
  <a class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline" href="/"
    >{t.project.title}</a
  >
  {
    project.map(({ projectId, projectName }) => (
      <div>
        <p>Project ID: {projectId}</p>
        <p>Project Name: {projectName}</p>
      </div>
    ))
  }
  {
    tasks.map(({ taskId, title, description, deadline, status }) => (
      <div>
        <p>Task ID: {taskId}</p>
        <p>
          Task title:{" "}
          <a
            class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline"
            href={`/project/${projectId}/${taskId}`}
          >
            {title}
          </a>
        </p>
        <p>Task description: {description}</p>
        <p>
          Deadline:{" "}
          {deadline !== null
            ? `${deadline!.getDate()}.${deadline!.getMonth() + 1}.${deadline!.getFullYear()}`
            : null}
        </p>
        <p>Status: {status}</p>
      </div>
    ))
  }
  <!-- <AddTask projectRef={id} client:load /> -->
</Layout>
