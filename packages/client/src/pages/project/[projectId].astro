---
import { useTranslations } from "@wolf-project/i18n";
import Layout from "../../components/Layout.astro";
import { db, like, Projects, Tasks } from "astro:db";
import { AddTask } from "../../components/Task";

const t = useTranslations("en");

const { projectId } = Astro.params;
const id = projectId?.split("/")[0];
if (!id) throw new Error("id is required");
console.log("ID:", id);
const project = await db.select().from(Projects).where(like(Projects.projectId, id));
const tasks = await db.select().from(Tasks).where(like(Tasks.projectRef, id));
---

<Layout title={undefined} description={undefined}>
  <a class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline" href="/"
    >{t.project.title}</a
  >
  {
    project.map(({ projectId, projectName }) => (
      <div>
        <p>Project ID: {projectId}</p>
        <p>Project Name: {projectName}</p>
      </div>
    ))
  }
  {
    tasks.map(({ taskId, title, description, deadline, status }) => (
      <div>
        <p>Task ID: {taskId}</p>
        <p>
          Task title:{" "}
          <a
            class="font-medium text-blue-600 underline dark:text-blue-500 hover:no-underline"
            href={`./${id}/${taskId}`}
          >
            {title}
          </a>
        </p>
        <p>Task description: {description}</p>
        <p>
          Deadline:{" "}
          {deadline !== null
            ? `${deadline!.getDate()}.${deadline!.getMonth() + 1}.${deadline!.getFullYear()}`
            : null}
        </p>
        <p>Status: {status}</p>
      </div>
    ))
  }
  <AddTask projectRef={id} client:load />
</Layout>
