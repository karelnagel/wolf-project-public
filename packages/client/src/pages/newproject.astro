---
import { usersTable } from "@wolf-project/db/schema";
import { db } from "@wolf-project/db";
import Layout from "../components/Layout.astro";
import { NewProject } from "../components/NewProject/NewProject";
import { or, eq } from "drizzle-orm";

const user = Astro.locals.user!;
if (user.role !== "admin" && user.role !== "limited") return Astro.redirect("/401");

const employees = await db.query.usersTable.findMany({
  where: or(eq(usersTable.role, "admin"), eq(usersTable.role, "limited")),
});
---

<Layout title={undefined} description={undefined}>
  <NewProject
    mandatoryMember={user.role === "limited" ? { id: user.id, name: user.name } : undefined}
    employees={employees}
    creatorId={user.id}
    client:load
  />
</Layout>
