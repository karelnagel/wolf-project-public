---
import { db, Users, eq, or } from "astro:db";
import Layout from "../components/Layout.astro";
import { NewProject } from "../components/NewProject/NewProject";

const userId = Astro.locals.userId;
const role = (
  await db.select({ role: Users.role }).from(Users).where(eq(Users.userId, userId!))
)?.[0];
if (role?.role !== "admin" && role?.role !== "limited") return Astro.redirect("/401");

const employees = await db
  .select({ value: Users.userId, label: Users.name })
  .from(Users)
  .where(or(eq(Users.role, "admin"), eq(Users.role, "limited")));
---

<Layout title={undefined} description={undefined}>
  <NewProject creatorId={userId!} creatorRole={role!.role} employees={employees} client:load />
</Layout>
